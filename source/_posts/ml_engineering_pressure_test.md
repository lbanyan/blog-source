---
title: 机器学习工程压测
tags:
    - 机器学习
    - 压测
---

![](/img/engineering_pressure_test.jpg)
## 压测方式
将真实线上用户灰度到测试组机器。

## 特殊说明
由于不同时间段访问用户数不同，所以适当调整了灰度用户比率，以达到在这段时间内灰度访问量的可比性。

<!--more-->

## 灰度时间段
时长统一15分钟。平均处理时间指整个访问处理时间。

## 压测报告
- 测试1、测试4、测试7比较，C3机型在访问量大于或接近C2机型的情况下，平均处理时间小于C2机型，且引发的ranking处理超时数小于C2机型；
- 测试2、测试4、测试7比较，C3机型在访问量高于C2机型1/3以上的情况下，平均处理时间是C2机型的63%左右，引发的ranking处理超时数小于单机14个ranking进程的C2机型，稍大于单机22个ranking进程的C2机型；
- 测试3、测试5比较，C3机型访问量是C2机型的1.23倍，平均处理时间是C2机型的1.05倍，ranking超时事件数是C2机型的0.0086倍，且C3机型遭遇过一次异常QPS；
- 测试1、测试2、测试3比较，在平均QPS增加的情况下，平均处理时间也相应增加，在单机负载从6.89变成9.58后，平均处理时间陡增，ranking处理超时时间也有所增加；
- 测试4、测试7比较，测试4访问量是测试7的1.54倍，平均处理时间是测试7的1.10倍，增加C2机型的ranking进程数在加快任务处理速度上并没有明显提升。

## 总结
- 通过以上比较，可得出在当前ranking模型下，C3机型相对于C2机型，相同吞吐量下，处理速度更快，且稳定性更好。这条结论和我们通常认知的核数越多，并发处理能力越好正好相反，对于CPU消耗型的ranking服务，其更需要主频越高的CPU。
- 根据测试报告第4条，可以基本得出单机负载大于cpu核数后，平均处理时长显著增加，ranking处理超时有所增加。