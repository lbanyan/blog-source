---
title: 机器学习推荐系统增量推荐优化
tag:
    - 机器学习
    - 增量推荐
---

## 背景
平台每次筛选300个在线主播进行打分排序。将这300个主播分三批，每批100个，交给三个机器学习的进程打分，目前该进程完成每批打分需要120ms左右。为了降低机器学习进程负载，考虑采用增量方式打分推荐。
1. 主播会下线。
2. 每次筛选出的300个主播中有部分是重复的。
3. 用于机器学习计算所需的用户特征2分钟更新一次。
4. 不同的用户推荐不同的主播，不同的用户的主播的打分不同，即此为个性化推荐。

<!--more-->

## 做法
为了提高性能，弱化掉上述第3点，即弱化平台的部分实时性。将每次推荐的主播打分缓存起来，下次推荐时，新选出的300个主播，只对没有打分的主播打分。此缓存时效2小时。

### 事先准备
以下验证均验证峰值时段，因为平台只要可以扛得住峰值时段，其他时段就没什么问题。
- 需先确认2小时内用户再次请求比例
如果为0，则此缓存没有意义。经统计，大致15%左右的用户会产生再次请求。
- 需先确认所需缓存的内存容量
如果所需缓存大小上百G，在不使用缓存集群的情况下，此缓存功能无法实现。我的公共缓存使用的是Redis，30万用户缓存大小为3.47G。此处部分数据涉嫌公司秘密，不便详解。经验证，我的那台Redis机器内存足够。
- 验证峰值情况下Redis性能
经验证，恶劣情况下，读写一条数据，均在1.6ms左右。可以满足业务要求。注意，需要清理掉这台缓存服务器上其他不相干的服务，以防止其他服务进程占用内存导致异常。
- 使用redis.setex设置该缓存，缓存时长2小时，

key value来存，每个设置时效2小时 可调整时效
TODO 超过内存阈值，该如何处理，是否有key数量的限制或者清理能力
TODO 目前缓存改为1小时，原因是用户特征变化会导致打分变化很大，直接影响到排序效果了


