---
title: 《QQ 空间基于 QUIC 协议的客户端加速方案》会议总结
date: 2018-01-25 10:05
tags:
    - HTTP
    - QUIC
---

### 会议总结

#### HTTP 各版本区别

1. HTTP 1.0 每次请求都会有开启和关闭连接动作，不支持请求并行；
2. HTTP 1.1 开启连接后，可以复用多次，再关闭连接；连接由 keepalive 来维持，不支持请求并行；
3. HTTP pipelining 多路复用，支持请求并行，但不支持返回乱序，会出现第一个请求处理阻塞时，之后请求的返回也会被阻塞的问题（队首阻塞）；
3. HTTP 2.0 多路复用，支持请求并行，支持返回乱序。

<!--more-->

#### 测试工具推荐
[WEBPAGETEST](http://www.webpagetest.org/)

#### TCP 很可能就是下一个性能瓶颈
原话来自于《Web 性能权威指南》 12.3.5 章节。
HTTP 2.0 解决了队首阻塞的问题，但这是应用层解决的，TCP 传输层仍然会存在队首阻塞的问题。
使用 HTTP 2.0 会导致 TCP 队首阻塞的问题更加明显，因为 HTTP 2.0 多路复用，使用同一个基于 TCP 的 Socket 链路，当出现网络丢包问题时，由于受 TCP 拥塞控制及丢包恢复等特性影响，会导致后续请求阻塞。丢包率严重情况下，HTTP 2.0 性能不如 HTTP 1.1。

#### HTTP 2.0 和 QUIC 区别
HTTPS 经过 TCP 三次握手后，需再经过 TLS 握手来完成，即需要多次 RTT 才能完成连接的建立。
QUIC 基于 UDP，不需要握手和建立连接，第一次通信便可直接发送数据，即此时便可以将加密、安全等进行协商。
QUIC 提供了 TLS 相关的安全性，并基于 UDP 传输，对用户透明。

#### 请求合并和请求分离
HTTP 1.1 时代，建议请求合并，即多个静态文件合为一个文件，从而减少客户端请求来实现加速，缺点是当修改静态文件中少量内容时，会导致客户端整个静态文件失效。
QUIC 时代，建议适当的请求分离，即多个静态文件可以不做合并为一个文件的处理，基于 QUIC 的多路复用，也可以保证请求的速度，这样也保证了客户端缓存命中率，即对一个文件的修改，不会导致所有缓存的失效。
服务端更好的做法是，既有合并后的文件，又有分离的文件，根据 HTTP 请求协议的不用，使用不同的文件返回给用户。

#### 负载均衡
主要是七层负载均衡（应用层）和四层负载均衡（传输层）。
为什么没有听说有三层或更底层的负载均衡，因为四层传输层是可以操作系统内核控制的，用户可以通过修改内核实现自己的负载均衡，例如 LVS，再底层就不受操作系统控制了，而是由网络设备来控制，技术以及技术的使用受网络硬件厂商决定。

#### TFO
TCP快速打开：TCP Fast Open，Linux 3.16开始默认开启了 TFO，Windows 暂时不支持。
它通过握手开始时的 SYN 包中的 TFO cookie（一个TCP选项）来验证一个之前连接过的客户端。该 SYN 包同时可以包含请求数据，服务端 cookie 验证成功后，直接处理该请求数据。

#### 视频地址
[腾讯云微服务架构交流会](http://www.itdks.com/eventlist/detail/1914)